/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2023 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include "main.h"  // include the header file with our structures for the registers we used



#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

int main(void)
{
	// so our goal is to configure the peripheral registers to accomplish LED toggle
	// we know we configure the peripheral register using its address

	/* create a pointer variable of the structures we created for the regiters we will use
	   RCC_AHB1ENR_t, GPIOx_MODE_t and GPIOx_ODR_t*/
	RCC_AHB1ENR_t volatile *const pClckCtrlreg = (RCC_AHB1ENR_t*)0x40023830;

	// initlilaze the pointer variable with the address of GPIO_D MODE register
	GPIOx_MODE_t volatile *const pGpioDMode = (GPIOx_MODE_t*)0x40020C00;

	GPIOx_ODR_t volatile *const pPortDOutreg = (GPIOx_ODR_t*)0x40020C14;


	/* now instead of refering to the Ref Manual and changing the specific bit by
	 bitwise operation we can simply change it using the structure variable
	 by derefencing (using arrow operator) and using the bitfield member name(pin_0,pin_1,etc)
	 Now we do not need to see the specific bit position by looking at the ref manual
	 everytime but just use the member bitfield name*/

	// enable the clock for GPIOD perpheral
	pClckCtrlreg->gpiod_en = 1;

	//configure the mode of pin12 as output
	pGpioDMode->pin_12 = 1;

	while(1)// loop forever
	{
		// turn LED ON
		pPortDOutreg->pin_12 = 1;
		// delay
		for(uint32_t i = 0;i<300000;i++)
		{
			;// empty loop for delay
		}



		// turn LED OFF
		pPortDOutreg->pin_12 = 0;
		// delay
		for(uint32_t i = 0;i<300000;i++)
		{
			;// empty loop for delay
		}
	}
}
