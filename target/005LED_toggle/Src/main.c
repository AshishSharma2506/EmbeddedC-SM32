/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2023 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */


// video 137
// toggling the LED ON and OFF using loops

#include <stdint.h>

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

int main(void)
{
	// copying the LED ON prorgram from 005LED
	// creating the pointer variables
	// all peripheral registers are of 32 bits so chose uint32_t
	uint32_t *pClckCtrlreg   = (uint32_t*) 0x40023830;
	uint32_t *pPortDModereg  = (uint32_t*) 0x40020C00;
	uint32_t *pPortDOutreg   = (uint32_t*) 0x40020C14;


	//1. Enable the clock for GPIOD peripheral in AHB1ENR (SET the 3rd bit position)
	*pClckCtrlreg = *pClckCtrlreg | (1<<3);


	//2. configure the mode of the IO pin as output
	// a) CLEAR the 24th and 25th postion
	*pPortDModereg &=  ~(3<<24); // as binary value of 3 is 11 so we shift by 24
	// b) SET the 24th bit
	*pPortDModereg |= 1<<24;


	while(1)   // infinite loop(super loop) to keep the LED toggling between ON and OFF. Can also use for(;;)
	{
		// turning ON the LED
		//3. SET 12th bit of GPIOD output data resgiter to make i/o pin 12 HIGH
		*pPortDOutreg |= 1<<12;


		// LED has been turned ON
		// now we have to create a small human observable delay using loop statement
		// this loop execure 10k times
		for(uint32_t i = 0 ; i < 300000 ; i++ )
		{
			;//empty variable
		}



		// turn OFF the LED
		// for that we have to RESET the 12th pin of GPIOD
		// CLEAR the 12th bit
		*pPortDOutreg &= ~(1<<12);


		//delay again
		// this loop execure 10k times
		for(uint32_t i = 0 ; i < 300000 ; i++ )
		{
			;//empty variable
		}
	}


	}
