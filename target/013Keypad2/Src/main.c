/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2023 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
// video 177
#include <stdint.h>
#include <stdio.h>
void delay(void)
{
	for(uint32_t i =0; i<300000; i++);
}
int main(void)
{
	// peripehral register addresses
	uint32_t volatile *const pClckCtrlReg  = (uint32_t*)(0x40023800 + 0x30);
	uint32_t volatile *const pGpioDModeReg = (uint32_t*)(0x40020C00 + 0x00);
	uint32_t volatile *const pGpioDInReg   = (uint32_t*)(0x40020C00 + 0x10);
	uint32_t volatile *const pGpioDOutReg  = (uint32_t*)(0x40020C00 + 0x14);
	uint32_t volatile *const pGpioDPullUpDown = (uint32_t*)(0x40023800 + 0x0C);


	// INTIALIZATION

	// refer to ECB 56(i)
	// 1. Enable the peripheral clock for GPIO D
	*pClckCtrlReg |= (1 << 3);

	// 2. Configure the Pins as I/P and O/P
	// we chose PD 0,1,2,3 as O/P as row keys will be connected to it (R1,R2,R3,R4 resp)
	// clear these fields first for safety
	*pGpioDModeReg &= ~(0xFF);

	*pGpioDModeReg |= 0x55; // refer V177 - 1:10.     Setting them to O/P


	// now I/P for PD 8,9,10,11
	*pGpioDModeReg &= ~(0xFF << 16); // refer V177 - 2:15


	//3. Enable Internal Pull Up registers for PD8,9,10,11
	//Refer V177 3:30
	// first clear them
	*pGpioDPullUpDown &= ~(0xFF << 16);
	// Enable the resistors
	*pGpioDPullUpDown |= (0x55 << 16);


while(1)
{
	// MAKE ALL ROWS HIGH
	*pGpioDOutReg |= 0x0F;



	// make R1(PD0) LOW. Clear that bit
	*pGpioDOutReg &= ~(1<<0);

	// scan/check the colums (PD 8-11)
	// read C1(PD8)
	if (!(*pGpioDInReg & (1 << 8))) // as it will be LOW when key IS pressed
		{
		delay(); // delay for button debouncing
		printf("1\n");
		}
	// check/read C2(PD9)
	if (!(*pGpioDInReg & (1 << 9)))
		{
		delay();
		printf("2\n");
		}
	// check/read C3(PD10)
	if (!(*pGpioDInReg & (1 << 10)))
		{
		delay();
		printf("3\n");
		}
	// check/read C4(PD11)
	if (!(*pGpioDInReg & (1 << 11)))
		{
		delay();
		printf("A\n");
		}



	// make R2(PD1) LOW. Clear that bit
	// but bfeore make sure all other rows are HIGH
	*pGpioDOutReg |= (0x0F);// did earlier before making R1 LOW
	*pGpioDOutReg &= ~(1 << 1);

	// scan/check the colums (PD 8-11)
	// read C1(PD8)
	if (!(*pGpioDInReg & (1 << 8))) // as it will be LOW when key IS pressed
		{
		delay(); // delay for button debouncing
		printf("4\n");
		}
	// check/read C2(PD9)
	if (!(*pGpioDInReg & (1 << 9)))
		{
		delay();
		printf("5\n");
		}
	// check/read C3(PD10)
	if (!(*pGpioDInReg & (1 << 10)))
		{
		delay();
		printf("6\n");
		}
	// check/read C4(PD11)
	if (!(*pGpioDInReg & (1 << 11)))
		{
		delay();
		printf("B\n");
		}


	// make R3(PD2) LOW. Clear that bit
	// but bfeore make sure all other rows are HIGH
	*pGpioDOutReg |= (0x0F);// did earlier before making R1 LOW
	*pGpioDOutReg &= ~(1 << 2);

	// scan/check the colums (PD 8-11)
	// read C1(PD8)
	if (!(*pGpioDInReg & (1 << 8))) // as it will be LOW when key IS pressed
		{
		delay(); // delay for button debouncing
		printf("7\n");
		}
	// check/read C2(PD9)
	if (!(*pGpioDInReg & (1 << 9)))
		{
		delay();
		printf("8\n");
		}
	// check/read C3(PD10)
	if (!(*pGpioDInReg & (1 << 10)))
		{
		delay();
		printf("9\n");
		}
	// check/read C4(PD11)
	if (!(*pGpioDInReg & (1 << 11)))
		{
		delay();
		printf("C\n");
		}



	// make R4(PD3) LOW. Clear that bit
	// but bfeore make sure all other rows are HIGH
	*pGpioDOutReg |= (0x0F);// did earlier before making R1 LOW
	*pGpioDOutReg &= ~(1 << 3);

	// scan/check the colums (PD 8-11)
	// read C1(PD8)
	if (!(*pGpioDInReg & (1 << 8))) // as it will be LOW when key IS pressed
		{
		delay(); // delay for button debouncing
		printf("*\n");
		}
	// check/read C2(PD9)
	if (!(*pGpioDInReg & (1 << 9)))
		{
		delay();
		printf("0\n");
		}
	// check/read C3(PD10)
	if (!(*pGpioDInReg & (1 << 10)))
		{
		delay();
		printf("#\n");
		}
	// check/read C4(PD11)
	if (!(*pGpioDInReg & (1 << 11)))
		{
		delay();
		printf("D\n");
		}


}//while end

}
